<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>AI Website Generator</title>
<style>
body {
  margin: 0;
  display: flex;
  height: 100vh;
  background: #0b0e11;
  color: #e6e6e6;
  font-family: system-ui;
}
#chat {
  width: 40%;
  padding: 16px;
  border-right: 1px solid #222;
  display: flex;
  flex-direction: column;
}
#messages {
  flex: 1;
  overflow-y: auto;
}
#messages div {
  margin-bottom: 10px;
}
#input {
  width: 100%;
  padding: 10px;
  background: #111;
  color: #fff;
  border: 1px solid #333;
}
#preview {
  flex: 1;
  border: none;
  background: #fff;
}
</style>
</head>

<body>

<div id="chat">
  <div id="messages"></div>
  <input id="input" placeholder="Describe the website you want, or ask for changesâ€¦" />
</div>

<iframe id="preview"></iframe>

<script>
let site = null;
let revision = null;
let currentPage = "home";

const messages = document.getElementById("messages");
const input = document.getElementById("input");
const preview = document.getElementById("preview");

function addMessage(role, text) {
  const div = document.createElement("div");
  div.textContent = role + ": " + text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

input.addEventListener("keydown", async e => {
  if (e.key !== "Enter") return;

  const message = input.value.trim();
  if (!message) return;
  input.value = "";

  addMessage("You", message);

  const res = await fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message, site, revision })
  });

  const data = await res.json();
  addMessage("AI", data.message);

  site = data.site;
  revision = data.revision;
  if (data.page) currentPage = data.page;

  preview.src = `/builds/${site}/${revision}/${currentPage}.html`;
});
</script>

</body>
</html>
