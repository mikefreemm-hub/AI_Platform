<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>AI Platform v0.19</title>

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  height: 100vh;
  display: flex;
  flex-direction: column;
}
header {
  padding: 12px 16px;
  border-bottom: 1px solid #1e293b;
  font-weight: 600;
}
#main {
  flex: 1;
  display: flex;
  overflow: hidden;
}
#chatPane {
  width: 40%;
  min-width: 360px;
  border-right: 1px solid #1e293b;
  display: flex;
  flex-direction: column;
}
#chat {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.message {
  max-width: 90%;
  padding: 12px 14px;
  border-radius: 8px;
}
.user { align-self: flex-end; background: #2563eb; color: white; }
.assistant { align-self: flex-start; background: #1e293b; }
form {
  border-top: 1px solid #1e293b;
  padding: 12px;
  display: flex;
  gap: 8px;
}
textarea {
  flex: 1;
  resize: none;
  padding: 10px;
  border-radius: 6px;
  border: none;
  outline: none;
  font-size: 14px;
  background: #020617;
  color: #e5e7eb;
  height: 48px;
}
button {
  padding: 0 16px;
  border-radius: 6px;
  border: none;
  background: #22c55e;
  color: #020617;
  font-weight: 600;
  cursor: pointer;
}
#previewPane {
  flex: 1;
  background: #020617;
  display: flex;
  flex-direction: column;
}
#previewHeader {
  padding: 10px 14px;
  border-bottom: 1px solid #1e293b;
  font-size: 13px;
  color: #94a3b8;
  display: flex;
  gap: 12px;
  align-items: center;
}
iframe {
  flex: 1;
  border: none;
  background: white;
}
</style>
</head>

<body>

<header>AI Platform v0.19</header>

<div id="main">

  <div id="chatPane">
    <div id="chat"></div>
    <form id="form">
      <textarea id="input" placeholder="Message AI Platform…" required></textarea>
      <button type="submit">Send</button>
    </form>
  </div>

  <div id="previewPane">
    <div id="previewHeader">
      <span id="siteLabel">Site: —</span>
      <span id="revisionLabel">Revision: —</span>
    </div>
    <iframe id="preview"></iframe>
  </div>

</div>

<script>
const chat = document.getElementById("chat");
const form = document.getElementById("form");
const input = document.getElementById("input");
const preview = document.getElementById("preview");
const siteLabel = document.getElementById("siteLabel");
const revisionLabel = document.getElementById("revisionLabel");

function addMessage(role, text) {
  const div = document.createElement("div");
  div.className = "message " + role;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const message = input.value.trim();
  if (!message) return;

  addMessage("user", message);
  input.value = "";

  const res = await fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message })
  });

  const data = await res.json();
  addMessage("assistant", data.message);

  siteLabel.textContent = "Site: " + data.site;
  revisionLabel.textContent = "Revision: " + data.revision;

  // ✅ DIRECT, GUARANTEED PATH
  preview.src = `/builds/${data.site}/${data.revision}/${data.page || "home"}.html`;
});
</script>

</body>
</html>
