<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AI Platform v0.19</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: #0b0e11;
      color: #e6e6e6;
      display: flex;
      height: 100vh;
    }

    #chat {
      width: 40%;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #222;
    }

    #messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      font-size: 14px;
    }

    .msg { margin-bottom: 10px; }
    .user { color: #7dd3fc; }
    .ai { color: #a7f3d0; }

    #inputBar {
      display: flex;
      border-top: 1px solid #222;
    }

    #input {
      flex: 1;
      padding: 12px;
      background: #111;
      color: #fff;
      border: none;
      outline: none;
    }

    button {
      padding: 0 18px;
      background: #2563eb;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    #preview {
      flex: 1;
      background: #ffffff;
      color: #000;
      padding: 40px;
      overflow-y: auto;
    }

    section {
      margin-bottom: 40px;
    }
  </style>
</head>
<body>

<div id="chat">
  <div id="messages"></div>
  <div id="inputBar">
    <input id="input" placeholder="Describe or refine your site..." />
    <button onclick="send()">Send</button>
  </div>
</div>

<div id="preview">
  <em>No site yet.</em>
</div>

<script>
let currentSpec = null;

const messages = document.getElementById("messages");
const preview = document.getElementById("preview");

function addMsg(text, cls) {
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function renderValue(value, container) {
  if (typeof value === "string") {
    const p = document.createElement("p");
    p.textContent = value;
    container.appendChild(p);
  }
  else if (Array.isArray(value)) {
    value.forEach(v => renderValue(v, container));
  }
  else if (typeof value === "object" && value !== null) {
    Object.values(value).forEach(v => renderValue(v, container));
  }
}

function render(spec) {
  preview.innerHTML = "";

  if (!spec || !spec.pages) {
    preview.innerHTML = "<em>Empty page</em>";
    return;
  }

  const pageKey = Object.keys(spec.pages)[0];
  const page = spec.pages[pageKey];

  const h1 = document.createElement("h1");
  h1.textContent = page.title || page.name || "Untitled Page";
  preview.appendChild(h1);

  if (!Array.isArray(page.sections)) {
    preview.innerHTML += "<em>Empty page</em>";
    return;
  }

  page.sections.forEach(section => {
    const s = document.createElement("section");
    renderValue(section, s);
    preview.appendChild(s);
  });
}

async function send() {
  const input = document.getElementById("input");
  const text = input.value.trim();
  if (!text) return;

  input.value = "";
  addMsg(text, "user");

  const res = await fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: text })
  });

  const data = await res.json();
  currentSpec = data.spec;

  addMsg("Updated site", "ai");
  render(currentSpec);
}

document.getElementById("input")
  .addEventListener("keydown", e => {
    if (e.key === "Enter") send();
  });
</script>

</body>
</html>
